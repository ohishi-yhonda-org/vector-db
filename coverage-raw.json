$ vitest run --coverage --run

[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/node/vector-db[39m
      [2mCoverage enabled with [22m[33mistanbul[39m

[vpw:info] Starting single runtime for vitest.config.ts...
[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould use custom namespace and metadata for PDF
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 3: Vectorizing 2 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/2: embed_pdf_test.pdf_0_mezd1qtx
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/2: pdf_test.pdf_0_mezd1qtx
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/2: embed_pdf_test.pdf_1_mezd1qtz
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/2: pdf_test.pdf_1_mezd1qtz
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Vectorization complete. Saved 2 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould process PDF file successfully
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould process image file successfully
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI analysis failure
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle processing error
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle processing error
[22m[39m[FileProcessingWorkflow] File processing failed: Error: Processing failed
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:206:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error details: Error: Processing failed
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:206:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle long text chunking
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 5

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: \nEXTRACTED_TEXT: Some text\nTOPICS: topics\nKEYWORDS: keywords"}
[FileProcessingWorkflow] Extracted text length: 73
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1qu7
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1qu7
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1qu7
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1qu7
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1qu7
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1qu7
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without topics and keywords
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1qu8
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1qu8
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1qu9
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1qu9
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1qu9
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1qu9
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without extracted text
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 13
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test image\nEXTRACTED_TEXT: \nTOPICS: image topics\nKEYWORDS: image, test"}
[FileProcessingWorkflow] Extracted text length: 83
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_ima_test.jpg_0_mezd1qua
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: ima_test.jpg_0_mezd1qua
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_ima_test.jpg_1_mezd1qua
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: ima_test.jpg_1_mezd1qua
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_ima_test.jpg_2_mezd1qua
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: ima_test.jpg_2_mezd1qua
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error thrown in AI analysis
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error thrown in AI analysis
[22m[39m[FileProcessingWorkflow] AI analysis failed: String error not an Error object
[FileProcessingWorkflow] Error stack: No stack

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI run failure inside step
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1quc
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1quc
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1quc
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1quc
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1quc
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1quc
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI run failure inside step
[22m[39m[FileProcessingWorkflow] AI analysis failed: Error: AI service error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:426:50
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error stack: Error: AI service error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:426:50
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle text exactly at chunk boundary
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Boundary test\nEXTRACTED_TEXT: BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
[FileProcessingWorkflow] Extracted text length: 2075
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 5 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 5 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/5: embed_pdf_boundary.p_0_mezd1qud
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/5: pdf_boundary.p_0_mezd1qud
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/5: embed_pdf_boundary.p_1_mezd1que
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/5: pdf_boundary.p_1_mezd1que
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/5: embed_pdf_boundary.p_2_mezd1que
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/5: pdf_boundary.p_2_mezd1que
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Creating embedding workflow 4/5: embed_pdf_boundary.p_3_mezd1que
[FileProcessingWorkflow] Polling embedding workflow for chunk 4
[FileProcessingWorkflow] Embedding completed for chunk 4
[FileProcessingWorkflow] Embedding generated for chunk 4, vector dims: 3
[FileProcessingWorkflow] Saving vector 4/5: pdf_boundary.p_3_mezd1que
[FileProcessingWorkflow] Vector saved for chunk 4
[FileProcessingWorkflow] Successfully saved vector for chunk 4
[FileProcessingWorkflow] Creating embedding workflow 5/5: embed_pdf_boundary.p_4_mezd1que
[FileProcessingWorkflow] Polling embedding workflow for chunk 5
[FileProcessingWorkflow] Embedding completed for chunk 5
[FileProcessingWorkflow] Embedding generated for chunk 5, vector dims: 3
[FileProcessingWorkflow] Saving vector 5/5: pdf_boundary.p_4_mezd1que
[FileProcessingWorkflow] Vector saved for chunk 5
[FileProcessingWorkflow] Successfully saved vector for chunk 5
[FileProcessingWorkflow] Vectorization complete. Saved 5 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 5

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould use fallback description when AI returns no description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"EXTRACTED_TEXT: Some content\nTOPICS: test"}
[FileProcessingWorkflow] Extracted text length: 41
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1quf
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1quf
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1quf
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1quf
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1quf
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1quf
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error exception in catch block
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error exception in catch block
[22m[39m[FileProcessingWorkflow] File processing failed: String error
[FileProcessingWorkflow] Error details: No stack

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle image error with proper type
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle image error with proper type
[22m[39m[FileProcessingWorkflow] File processing failed: Error: Image processing error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:524:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error details: Error: Image processing error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:524:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with text field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with description field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with generated_text field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with result field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response as direct string
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response that returns boolean true
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: boolean
[FileProcessingWorkflow] AI result: true
[FileProcessingWorkflow] Extracted text length: 0
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with null result
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with empty object
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response that returns object without string properties
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":123,"text":false,"description":null,"result":{}}
[FileProcessingWorkflow] Extracted text length: 0
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with non-string fields
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle undefined response from extractTextFromResult
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file analysis without description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"EXTRACTED_TEXT: Just text content\nTOPICS: pdf\nKEYWORDS: test"}
[FileProcessingWorkflow] Extracted text length: 60
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file analysis without topics and keywords
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle error in extractTextFromResult
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle error in extractTextFromResult
[22m[39m[FileProcessingWorkflow] AI analysis failed: Error: Property access error
    at Object.get (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1014:17)
    at Promise.resolve (<anonymous>)
    at Object.<anonymous> (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:124:83)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at /C:/node/vector-db/src/workflows/file-processing.ts:3635:71
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1020:24)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as do] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessingWorkflow.processFile (/C:/node/vector-db/src/workflows/file-processing.ts:3600:68)
[FileProcessingWorkflow] Error stack: Error: Property access error
    at Object.get (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1014:17)
    at Promise.resolve (<anonymous>)
    at Object.<anonymous> (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:124:83)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at /C:/node/vector-db/src/workflows/file-processing.ts:3635:71
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1020:24)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as do] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessingWorkflow.processFile (/C:/node/vector-db/src/workflows/file-processing.ts:3600:68)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle empty string response from AI
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle embedding generation failure and skip chunk
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content\nTOPICS: test\nKEYWORDS: pdf"}
[FileProcessingWorkflow] Extracted text length: 72
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1qus
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1qus
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1qus
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1qus
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1qus
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1qus
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould handle unsupported file type
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.txt',
  fileType: 'text/plain',
  fileSize: 100,
  namespace: undefined
}

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould process PDF file through run method
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.pdf',
  fileType: 'application/pdf',
  fileSize: 1024,
  namespace: undefined
}
[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezd1quv
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezd1quv
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezd1quv
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezd1quv
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezd1quw
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezd1quw
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould process image file through run method
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.png',
  fileType: 'image/png',
  fileSize: 2048,
  namespace: undefined
}
[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 13
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test image\nEXTRACTED_TEXT: "}
[FileProcessingWorkflow] Extracted text length: 40
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_ima_test.png_0_mezd1qux
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: ima_test.png_0_mezd1qux
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_ima_test.png_1_mezd1qux
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: ima_test.png_1_mezd1qux
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_ima_test.png_2_mezd1qux
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: ima_test.png_2_mezd1qux
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle large file (>2MB) with simple extraction
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 17
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] File too large for AI analysis (>2MB), using simple extraction
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_large.pdf_0_mezd1qv0
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_large.pdf_0_mezd1qv0
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_large.pdf_1_mezd1qv1
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_large.pdf_1_mezd1qv1
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_large.pdf_2_mezd1qv1
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_large.pdf_2_mezd1qv1
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow errored status
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 2 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/2: embed_pdf_test.pdf_0_mezd1qv2
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/2: embed_pdf_test.pdf_1_mezd1qv2
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow errored status
[22m[39m[FileProcessingWorkflow] Embedding workflow failed for chunk 1: Embedding generation failed
[FileProcessingWorkflow] Failed to generate embedding for chunk 1: Timeout
[FileProcessingWorkflow] Embedding workflow failed for chunk 2: Embedding generation failed
[FileProcessingWorkflow] Failed to generate embedding for chunk 2: Timeout

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow errored status
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezd1qv3
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezd1qv3
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow errored status
[22m[39m[FileProcessingWorkflow] Vector save failed for chunk 1: Vector save failed
[FileProcessingWorkflow] Failed to save vector for chunk 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save success false result
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezd1qv4
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezd1qv4
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save success false result
[22m[39m[FileProcessingWorkflow] Failed to save vector for chunk 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow with pending status then complete
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezd1qv5
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezd1qv5
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 1 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow with pending status then complete
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezd1qv6
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezd1qv6
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 1 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

 [32m✓[39m tests/unit/workflows/file-processing.test.ts [2m([22m[2m58 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould create vector asynchronously using workflow
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector saved successfully: vec-123

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould use default namespace when undefined and handle undefined recentVectors
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector saved successfully: vec-123

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding workflow failure
[22m[39mAttempt 1: Workflow status: { status: 'errored', error: 'Embedding failed' }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding workflow failure with undefined error
[22m[39mAttempt 1: Workflow status: { status: 'errored', error: undefined }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding timeout
[22m[39mAttempt 1: Workflow status: { status: 'running' }
Attempt 2: Workflow status: { status: 'running' }
Attempt 3: Workflow status: { status: 'running' }
Attempt 4: Workflow status: { status: 'running' }
Attempt 5: Workflow status: { status: 'running' }
Attempt 6: Workflow status: { status: 'running' }
Attempt 7: Workflow status: { status: 'running' }
Attempt 8: Workflow status: { status: 'running' }
Attempt 9: Workflow status: { status: 'running' }
Attempt 10: Workflow status: { status: 'running' }
Attempt 11: Workflow status: { status: 'running' }
Attempt 12: Workflow status: { status: 'running' }
Attempt 13: Workflow status: { status: 'running' }
Attempt 14: Workflow status: { status: 'running' }
Attempt 15: Workflow status: { status: 'running' }
Attempt 16: Workflow status: { status: 'running' }
Attempt 17: Workflow status: { status: 'running' }
Attempt 18: Workflow status: { status: 'running' }
Attempt 19: Workflow status: { status: 'running' }
Attempt 20: Workflow status: { status: 'running' }
Attempt 21: Workflow status: { status: 'running' }
Attempt 22: Workflow status: { status: 'running' }
Attempt 23: Workflow status: { status: 'running' }
Attempt 24: Workflow status: { status: 'running' }
Attempt 25: Workflow status: { status: 'running' }
Attempt 26: Workflow status: { status: 'running' }
Attempt 27: Workflow status: { status: 'running' }
Attempt 28: Workflow status: { status: 'running' }
Attempt 29: Workflow status: { status: 'running' }
Attempt 30: Workflow status: { status: 'running' }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow failure
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: errored

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow failure with undefined error
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: errored

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: { success: false, error: 'Model error' }
}

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding result
[22m[39mFinal embedding result: {
  success: false,
  embedding: [],
  model: 'unknown',
  error: 'Model error',
  vectorId: ''
}

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding with undefined error
[22m[39mAttempt 1: Workflow status: { status: 'complete', output: { success: false, error: undefined } }

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding with undefined error
[22m[39mFinal embedding result: {
  success: false,
  embedding: [],
  model: 'unknown',
  error: undefined,
  vectorId: ''
}

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful vector result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow timeout
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: running
Vector workflow attempt 2: running
Vector workflow attempt 3: running
Vector workflow attempt 4: running
Vector workflow attempt 5: running
Vector workflow attempt 6: running
Vector workflow attempt 7: running
Vector workflow attempt 8: running
Vector workflow attempt 9: running
Vector workflow attempt 10: running
Vector workflow attempt 11: running
Vector workflow attempt 12: running
Vector workflow attempt 13: running
Vector workflow attempt 14: running
Vector workflow attempt 15: running
Vector workflow attempt 16: running
Vector workflow attempt 17: running
Vector workflow attempt 18: running
Vector workflow attempt 19: running
Vector workflow attempt 20: running
Vector workflow attempt 21: running
Vector workflow attempt 22: running
Vector workflow attempt 23: running
Vector workflow attempt 24: running
Vector workflow attempt 25: running
Vector workflow attempt 26: running
Vector workflow attempt 27: running
Vector workflow attempt 28: running
Vector workflow attempt 29: running
Vector workflow attempt 30: running

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle null vector result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector workflow attempt 2: complete
Vector workflow attempt 3: complete
Vector workflow attempt 4: complete
Vector workflow attempt 5: complete
Vector workflow attempt 6: complete
Vector workflow attempt 7: complete
Vector workflow attempt 8: complete
Vector workflow attempt 9: complete
Vector workflow attempt 10: complete
Vector workflow attempt 11: complete
Vector workflow attempt 12: complete
Vector workflow attempt 13: complete
Vector workflow attempt 14: complete
Vector workflow attempt 15: complete
Vector workflow attempt 16: complete
Vector workflow attempt 17: complete
Vector workflow attempt 18: complete
Vector workflow attempt 19: complete
Vector workflow attempt 20: complete
Vector workflow attempt 21: complete
Vector workflow attempt 22: complete
Vector workflow attempt 23: complete
Vector workflow attempt 24: complete
Vector workflow attempt 25: complete
Vector workflow attempt 26: complete
Vector workflow attempt 27: complete
Vector workflow attempt 28: complete
Vector workflow attempt 29: complete
Vector workflow attempt 30: complete

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould remove deleted vectors from local state
[22m[39m[VectorManager] Removing 2 vectors from local state
[VectorManager] Updated local state, 1 vectors remaining

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle uninitialized recentVectors
[22m[39m[VectorManager] Removing 1 vectors from local state
[VectorManager] Initialized recentVectors array

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould delete all vectors
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Deleting 3 vectors from Vectorize
[VectorManager] Delete operation enqueued for 3 vectors
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould delete vectors by namespace
[22m[39m[VectorManager] Deleting all vectors in namespace: default
[VectorManager] Deleting 2 vectors from Vectorize
[VectorManager] Delete operation enqueued for 2 vectors
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle empty state when deleting all
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle uninitialized state when deleting all
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould continue on vectorize delete error
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Deleting 1 vectors from Vectorize
[VectorManager] Local state cleared

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould continue on vectorize delete error
[22m[39m[VectorManager] Error deleting from Vectorize: Error: Delete failed
    at /C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:834:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould throw error when state access fails
[22m[39m[VectorManager] Deleting all vectors in all namespaces

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould throw error when state access fails
[22m[39m[VectorManager] Delete all vectors error: Error: State access failed
    at VectorManager.get [as state] (/C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:849:17)
    at VectorManager.deleteAllVectors (/C:/node/vector-db/src/durable-objects/vector-manager.ts:5004:17)
    at /C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:853:56
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/durable-objects/vector-manager.test.ts [2m([22m[2m58 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync.test.ts [2m([22m[2m34 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[90m 19[2mms[22m[39m
[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPageFromNotion[2m > [22m[2mshould throw error on API failure (non-404)
[22m[39mFailed to fetch page from Notion: Error: Notion API error: 500
    at NotionService.fetchPageFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3823:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPagePropertyFromNotion[2m > [22m[2mshould throw error on property fetch failure
[22m[39mFailed to fetch property from Notion: Error: Notion API error: 500
    at NotionService.fetchPagePropertyFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3900:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPagePropertyFromNotion[2m > [22m[2mshould handle fetch errors
[22m[39mFailed to fetch property from Notion: Error: Network error
    at /C:/node/vector-db/tests/unit/notion.service.test.ts:159:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2msearchAllPages[2m > [22m[2mshould throw error on search failure
[22m[39mFailed to search pages from Notion: Error: Notion API error: 400
    at NotionService.searchAllPages (/C:/node/vector-db/src/services/notion.service.ts:4110:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mError handling[2m > [22m[2mshould handle fetch errors in fetchBlocksFromNotion
[22m[39mFailed to fetch blocks from Notion: Error: Notion API error: 500
    at NotionService.fetchBlocksFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3866:17)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mError handling[2m > [22m[2mshould handle network errors in fetchPageFromNotion
[22m[39mFailed to fetch page from Notion: Error: Network failed
    at /C:/node/vector-db/tests/unit/notion.service.test.ts:690:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/notion.service.test.ts [2m([22m[2m37 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould upload PDF file successfully
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=7d5c64f1b13d52681e32937e2e10c8cb',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796215,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould upload image file with namespace and metadata
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=62745256dbe4c173bd17afec1058ce30',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.jpg',
  type: 'image/jpeg',
  size: 3,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.jpg
Filename char codes: [
  116, 101, 115,
  116,  46, 106,
  112, 103
]
Decoded filename: test.jpg
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept PNG files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=d587806249a10aaa1ebf4c38b1cfd1a6',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.png',
  type: 'image/png',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.png
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  110, 103
]
Decoded filename: test.png
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept GIF files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=9a4431eb143c48eaa98face477c43867',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.gif',
  type: 'image/gif',
  size: 3,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.gif
Filename char codes: [
  116, 101, 115,
  116,  46, 103,
  105, 102
]
Decoded filename: test.gif
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept WebP files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=3e2d19f1cf1ebd0cae1527469733ddde',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.webp',
  type: 'image/webp',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.webp
Filename char codes: [
  116, 101, 115, 116,
   46, 119, 101,  98,
  112
]
Decoded filename: test.webp
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject files over 10MB
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=ac97466ca1d6d7e062d3e2c73dfc6159',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'large.pdf',
  type: 'application/pdf',
  size: 11534336,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: large.pdf
Filename char codes: [
  108, 97, 114, 103,
  101, 46, 112, 100,
  102
]
Decoded filename: large.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject unsupported file types
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=57abc44e7d4232e2f28e4964d97829b8',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.txt',
  type: 'text/plain',
  size: 5,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.txt
Filename char codes: [
  116, 101, 115,
  116,  46, 116,
  120, 116
]
Decoded filename: test.txt
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject invalid metadata JSON
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=16ca7896e98e191cdbea3afba7a1e01c',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle empty metadata
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=0f506fe96a0d95c7975972f3d6529503',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Durable Object errors
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=6293bd4ed3b163dc881ae1fb27bd014a',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Durable Object errors
[22m[39mFile upload error: Error: Processing failed
    at /C:/node/vector-db/tests/unit/routes/files/upload.test.ts:221:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle non-Error exceptions
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=1efb8f54e1f5c5e82a433d27afa1137f',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle non-Error exceptions
[22m[39mFile upload error: String error

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle file with special characters in name
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=7a6bf42cfd625f86e8be89cd133ab8d6',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test-file_2024.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test-file_2024.pdf
Filename char codes: [
  116, 101, 115, 116,  45, 102,
  105, 108, 101,  95,  50,  48,
   50,  52,  46, 112, 100, 102
]
Decoded filename: test-file_2024.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Japanese filename with direct Japanese characters
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=acbf5f3c494b557786c4cbc35d0e56fe',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'テスト文書.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: テスト文書.pdf
Filename char codes: [
  12486, 12473, 12488,
  25991, 26360,    46,
    112,   100,   102
]
Decoded filename: ƹȇ�.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle filename with percent encoding but no Japanese characters
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=21f619b5d7ab5dbea0468af72c288683',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test%20file.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test%20file.pdf
Filename char codes: [
  116, 101, 115, 116,  37,
   50,  48, 102, 105, 108,
  101,  46, 112, 100, 102
]
Decoded filename: test%20file.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle malformed percent-encoded filename
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=b940dcc30a0a871c16aa3be0f247717a',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test%ZZinvalid.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: test%ZZinvalid.pdf
Filename char codes: [
  116, 101, 115, 116,  37,  90,
   90, 105, 110, 118,  97, 108,
  105, 100,  46, 112, 100, 102
]
Decoded filename: test%ZZinvalid.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle FormData with non-File value after validation bypass
[22m[39mRequest headers: {
  'content-type': undefined,
  'content-length': undefined,
  'accept-charset': undefined
}

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle FormData with non-File value after validation bypass
[22m[39mNot a File object: not-a-file-object

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould decode Japanese filename from Latin-1 encoding
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=87e107ee19702cec782d9ad868c1c7ce',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x83\x86ã\x82¹ã\x83\x88æ\x96\x87æ\x9B¸.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: ãã¹ãææ¸.pdf
Filename char codes: [
  227, 131, 134, 227, 130,
  185, 227, 131, 136, 230,
  150, 135, 230, 155, 184,
   46, 112, 100, 102
]
Decoded filename: テスト文書.pdf
Using decoded filename: テスト文書.pdf

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle filename decoding errors gracefully
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=8d9aa158d4acd28b5f1f6582f9278de3',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x82¹ã\x83\x88ÿÿ.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: ã¹ãÿÿ.pdf
Filename char codes: [
  227, 130, 185, 227,
  131, 136, 255, 255,
   46, 112, 100, 102
]
Decoded filename: スト��.pdf
Using decoded filename: スト��.pdf

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle TextDecoder throwing error on invalid sequences
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=4665e1f356692de0e0e4b6219783c893',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x83\x86.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756624796216,
  constructor: 'File'
}
Original filename: ã.pdf
Filename char codes: [
  227, 131, 134,
   46, 112, 100,
  102
]
Failed to decode filename, using original: ã.pdf Error: Invalid byte sequence
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/routes/files/upload.test.ts:474:15)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as decode] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessor.decodeFileName (/C:/node/vector-db/src/routes/api/files/file-processor.ts:603:60)
    at Array.uploadFileHandler (/C:/node/vector-db/src/routes/api/files/upload.ts:688:84)
    at /C:/node/vector-db/tests/unit/routes/files/upload.test.ts:481:22
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/routes/files/upload.test.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/utils/validation.test.ts [2m([22m[2m62 tests[22m[2m)[22m[90m 16[2mms[22m[39m
[90mstderr[2m | tests/unit/durable-objects/notion-manager.test.ts[2m > [22m[2mNotionManager Durable Object[2m > [22m[2mgetWorkflowStatus[2m > [22m[2mshould handle errors gracefully
[22m[39mFailed to get workflow status: Error: Not found
    at /C:/node/vector-db/tests/unit/durable-objects/notion-manager.test.ts:434:72
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/durable-objects/notion-manager.test.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/list-pages.test.ts[2m > [22m[2mList Notion Pages Route[2m > [22m[2mGET /notion/pages[2m > [22m[2mshould handle errors
[22m[39mList pages error: Error: Notion API error
    at /C:/node/vector-db/tests/unit/routes/notion/list-pages.test.ts:313:63
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/list-pages.test.ts[2m > [22m[2mList Notion Pages Route[2m > [22m[2mGET /notion/pages[2m > [22m[2mshould handle non-Error exceptions
[22m[39mList pages error: String error

 [32m✓[39m tests/unit/routes/notion/list-pages.test.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-run.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mextractText[2m > [22m[2mshould handle extraction errors gracefully
[22m[39mFailed to extract text from property: Cannot read properties of null (reading 'map')

[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mprocessProperties[2m > [22m[2mshould skip unsupported property types
[22m[39mSkipping unsupported property type: unsupported_relation

[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mprocessProperties[2m > [22m[2mshould handle property processing errors gracefully
[22m[39mSkipping unsupported property type: invalid_property

 [32m✓[39m tests/unit/workflows/property-handlers.test.ts [2m([22m[2m37 tests[22m[2m)[22m[90m 8[2mms[22m[39m
 [32m✓[39m tests/unit/base/workflow.test.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 26[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a vector creation job
[22m[39m{"timestamp":"2025-08-31T07:19:57.051Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.051Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797051_636ihb3uf","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.051Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797051_636ihb3uf","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.053Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797051_636ihb3uf","duration":2,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a vector deletion job
[22m[39m{"timestamp":"2025-08-31T07:19:57.053Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.053Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797053_aos6yf5ev","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.053Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797053_aos6yf5ev","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.053Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797053_aos6yf5ev","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a file processing job
[22m[39m{"timestamp":"2025-08-31T07:19:57.054Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.054Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797054_suknn95u3","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.054Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797054_suknn95u3","type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.054Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797054_suknn95u3","duration":0,"type":"file:process"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process vector creation job successfully
[22m[39m{"timestamp":"2025-08-31T07:19:57.055Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.055Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797055_c89kpueam","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.055Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797055_c89kpueam","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.055Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797055_c89kpueam","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould handle vector creation job failure
[22m[39m{"timestamp":"2025-08-31T07:19:57.057Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.057Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797057_suvaeuhhv","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.057Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797057_suvaeuhhv","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.057Z","level":"ERROR","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job failed: job_vector_1756624797057_suvaeuhhv","error":{"name":"Error","message":"Workflow failed: Embedding failed","stack":"Error: Workflow failed: Embedding failed\n    at VectorJobManager.waitForWorkflow (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1987:17)\n    at VectorJobManager.processCreateVector (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1856:56)\n    at /C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1813:14\n    at VectorJobManager.processJob (/C:/node/vector-db/src/base/job-manager.ts:3125:48)"},"type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.057Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Retrying job: job_vector_1756624797057_suvaeuhhv","attempt":1,"maxRetries":3}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process vector deletion job successfully
[22m[39m{"timestamp":"2025-08-31T07:19:57.059Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.059Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797059_f3xua3pek","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.059Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797059_f3xua3pek","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.059Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797059_f3xua3pek","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process file job successfully
[22m[39m{"timestamp":"2025-08-31T07:19:57.060Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.060Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797060_6bhyg6z3d","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.060Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797060_6bhyg6z3d","type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.060Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797060_6bhyg6z3d","duration":0,"type":"file:process"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetJob[2m > [22m[2mshould return job by ID
[22m[39m{"timestamp":"2025-08-31T07:19:57.061Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.061Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797061_811p7gum2","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.061Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797061_811p7gum2","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.061Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797061_811p7gum2","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetJob[2m > [22m[2mshould return undefined for non-existent job
[22m[39m{"timestamp":"2025-08-31T07:19:57.061Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould list all jobs
[22m[39m{"timestamp":"2025-08-31T07:19:57.062Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.062Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797062_o5sqyhcvh","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.062Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797062_o5sqyhcvh","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.062Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797062_29kbbrty3","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.063Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797062_o5sqyhcvh","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould filter jobs by status
[22m[39m{"timestamp":"2025-08-31T07:19:57.063Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.063Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797063_qjrggygrx","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.063Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797063_qjrggygrx","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.063Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797063_gj7qt94t0","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797063_qjrggygrx","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould filter jobs by type
[22m[39m{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797064_7xwbajrh7","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797064_7xwbajrh7","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797064_noojyvpo8","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797064_7sn6r85gv","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.064Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797064_7xwbajrh7","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould cancel a queued job
[22m[39m{"timestamp":"2025-08-31T07:19:57.065Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.065Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797065_92if1nhbe","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.065Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797065_92if1nhbe","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.065Z","level":"WARN","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cannot cancel job with status processing: job_vector_1756624797065_92if1nhbe"}}
{"timestamp":"2025-08-31T07:19:57.066Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797065_92if1nhbe","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould not cancel a completed job
[22m[39m{"timestamp":"2025-08-31T07:19:57.066Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.066Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797066_5ny3l8jlr","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.066Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797066_5ny3l8jlr","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.066Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797066_5ny3l8jlr","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould not cancel a completed job
[22m[39m{"timestamp":"2025-08-31T07:19:57.076Z","level":"WARN","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cannot cancel job with status completed: job_vector_1756624797066_5ny3l8jlr"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mclearJobs[2m > [22m[2mshould clear all jobs
[22m[39m{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797071_kf6g860sp","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797071_kf6g860sp","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797071_pzsw397iw","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleared 2 jobs","onlyCompleted":false}}
{"timestamp":"2025-08-31T07:19:57.071Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797071_kf6g860sp","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetStatistics[2m > [22m[2mshould return job statistics
[22m[39m{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797072_ymui4kfg2","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797072_ymui4kfg2","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797072_qrjfmdnb4","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797072_lvm51lnba","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.072Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797072_ymui4kfg2","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould remove completed jobs older than retention period
[22m[39m{"timestamp":"2025-08-31T07:19:57.073Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.073Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1700000000000_jl0uaekj4","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.073Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1700000000000_jl0uaekj4","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.073Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1700000000000_zqkhlnbcf","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.073Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1700000000000_jl0uaekj4","duration":0,"type":"vector:create"}}
{"timestamp":"2025-08-31T07:19:57.083Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1700000000000_zqkhlnbcf","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.083Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1700000000000_zqkhlnbcf","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould remove completed jobs older than retention period
[22m[39m{"timestamp":"2025-08-31T07:19:57.093Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleaned up 1 old jobs","olderThanHours":24}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould not remove active jobs
[22m[39m{"timestamp":"2025-08-31T07:19:57.074Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T07:19:57.074Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797074_bd5rwsh8m","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.074Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797074_bd5rwsh8m","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.074Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756624797074_5ld31nh23","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T07:19:57.074Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797074_bd5rwsh8m","duration":0,"type":"vector:create"}}
{"timestamp":"2025-08-31T07:19:57.084Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756624797074_5ld31nh23","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T07:19:57.084Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756624797074_5ld31nh23","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould not remove active jobs
[22m[39m{"timestamp":"2025-08-31T07:19:57.094Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleaned up 0 old jobs","olderThanHours":24}}

 [32m✓[39m tests/unit/durable-objects/vector-job-manager.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/validation.test.ts [2m([22m[2m25 tests[22m[2m)[22m[90m 25[2mms[22m[39m
 [32m✓[39m tests/unit/utils/response-builder-compat.test.ts [2m([22m[2m43 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/utils/response-builder.test.ts [2m([22m[2m47 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/embedding-service.test.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 22[2mms[22m[39m
 [32m✓[39m tests/unit/utils/error-handler.test.ts [2m([22m[2m41 tests[22m[2m)[22m[90m 38[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mstate management[2m > [22m[2mshould set new state
[22m[39m[SyncStateMachine] State transition: initializing -> fetching_page

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2minitialize[2m > [22m[2mshould initialize successfully with valid context
[22m[39m[SyncStateMachine] State transition: initializing -> initializing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2minitialize[2m > [22m[2mshould fail with invalid page ID
[22m[39m[SyncStateMachine] State transition: initializing -> initializing
[SyncStateMachine] State transition: initializing -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2minitialize[2m > [22m[2mshould handle workflow step error
[22m[39m[SyncStateMachine] State transition: initializing -> initializing
[SyncStateMachine] State transition: initializing -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mfetchPage[2m > [22m[2mshould fetch page successfully
[22m[39m[SyncStateMachine] State transition: initializing -> fetching_page
[SyncStateMachine] State transition: fetching_page -> fetching_page
[SyncStateMachine] Page fetched successfully: test-page-123

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mfetchPage[2m > [22m[2mshould fail when page not found
[22m[39m[SyncStateMachine] State transition: initializing -> fetching_page
[SyncStateMachine] State transition: fetching_page -> fetching_page
[SyncStateMachine] State transition: fetching_page -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mfetchPage[2m > [22m[2mshould handle fetch error
[22m[39m[SyncStateMachine] State transition: initializing -> fetching_page
[SyncStateMachine] State transition: fetching_page -> fetching_page
[SyncStateMachine] State transition: fetching_page -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessProperties[2m > [22m[2mshould process properties successfully
[22m[39m[SyncStateMachine] State transition: initializing -> processing_properties
[SyncStateMachine] State transition: processing_properties -> processing_properties
[SyncStateMachine] Properties processed: 5
[SyncStateMachine] Vectors from properties: 10

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessProperties[2m > [22m[2mshould skip processing when includeProperties is false
[22m[39m[SyncStateMachine] State transition: initializing -> processing_properties
[SyncStateMachine] State transition: initializing -> processing_properties
[SyncStateMachine] Skipping properties processing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessProperties[2m > [22m[2mshould handle processing error
[22m[39m[SyncStateMachine] State transition: initializing -> processing_properties
[SyncStateMachine] State transition: processing_properties -> processing_properties
[SyncStateMachine] State transition: processing_properties -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessProperties[2m > [22m[2mshould accumulate counts in context
[22m[39m[SyncStateMachine] State transition: initializing -> processing_properties
[SyncStateMachine] State transition: processing_properties -> processing_properties
[SyncStateMachine] Properties processed: 2
[SyncStateMachine] Vectors from properties: 4

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessBlocks[2m > [22m[2mshould process blocks successfully
[22m[39m[SyncStateMachine] State transition: initializing -> processing_blocks
[SyncStateMachine] State transition: processing_blocks -> processing_blocks
[SyncStateMachine] Blocks processed: 8
[SyncStateMachine] Vectors from blocks: 15

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessBlocks[2m > [22m[2mshould skip processing when includeBlocks is false
[22m[39m[SyncStateMachine] State transition: initializing -> processing_blocks
[SyncStateMachine] State transition: initializing -> processing_blocks
[SyncStateMachine] Skipping blocks processing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessBlocks[2m > [22m[2mshould handle processing error
[22m[39m[SyncStateMachine] State transition: initializing -> processing_blocks
[SyncStateMachine] State transition: processing_blocks -> processing_blocks
[SyncStateMachine] State transition: processing_blocks -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mprocessBlocks[2m > [22m[2mshould accumulate counts in context
[22m[39m[SyncStateMachine] State transition: initializing -> processing_blocks
[SyncStateMachine] State transition: processing_blocks -> processing_blocks
[SyncStateMachine] Blocks processed: 3
[SyncStateMachine] Vectors from blocks: 6

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mcomplete[2m > [22m[2mshould complete successfully with summary
[22m[39m[SyncStateMachine] State transition: initializing -> completing
[SyncStateMachine] State transition: completing -> completing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mcomplete[2m > [22m[2mshould handle completion error
[22m[39m[SyncStateMachine] State transition: initializing -> completing
[SyncStateMachine] State transition: completing -> completing
[SyncStateMachine] State transition: completing -> failed

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould calculate progress for initializing state
[22m[39m[SyncStateMachine] State transition: initializing -> initializing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould calculate progress for fetching_page state
[22m[39m[SyncStateMachine] State transition: initializing -> fetching_page

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould calculate progress for processing_properties state
[22m[39m[SyncStateMachine] State transition: initializing -> processing_properties

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould calculate progress for processing_blocks state
[22m[39m[SyncStateMachine] State transition: initializing -> processing_blocks

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould calculate progress for completing state
[22m[39m[SyncStateMachine] State transition: initializing -> completing

[90mstdout[2m | tests/unit/workflows/sync-state-machine.test.ts[2m > [22m[2mSyncStateMachine[2m > [22m[2mgetProgress[2m > [22m[2mshould handle failed state
[22m[39m[SyncStateMachine] State transition: initializing -> failed

 [32m✓[39m tests/unit/workflows/sync-state-machine.test.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record error information
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.648Z',
  retryCount: 1,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record AppError with correct error code
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout error',
  stepName: 'timeout-step',
  timestamp: '2025-08-31T07:19:57.650Z',
  retryCount: 2,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record error with default retry count
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.650Z',
  retryCount: 0,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould allow retry for recoverable error under max retries
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.655Z',
  retryCount: 1,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould not allow retry for non-recoverable error
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.656Z',
  retryCount: 1,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould not allow retry when max retries exceeded
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.656Z',
  retryCount: 3,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mgetNextRetryCount[2m > [22m[2mshould return incremented retry count
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.658Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.658Z',
  retryCount: 2,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould execute operation successfully on first attempt
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould retry on recoverable error and succeed
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Step test-step succeeded after 2 attempts

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould retry on recoverable error and succeed
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.660Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould fail after max retries exceeded
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould fail after max retries exceeded
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.661Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.661Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.662Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould not retry on non-recoverable error
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould not retry on non-recoverable error
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.663Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute primary operation successfully
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute fallback on primary failure
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry
[ErrorRecovery] Primary operation failed for test-step, trying fallback
[ErrorRecovery] Fallback succeeded for step: test-step

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute fallback on primary failure
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.664Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.665Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.665Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould throw primary error when fallback also fails
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry
[ErrorRecovery] Primary operation failed for test-step, trying fallback

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould throw primary error when fallback also fails
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.666Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.666Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.666Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step
[ErrorRecovery] Fallback also failed for step: test-step
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Fallback failed',
  stepName: 'test-step_fallback',
  timestamp: '2025-08-31T07:19:57.666Z',
  retryCount: 0,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould skip on error when skipOnError is true
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould skip on error when skipOnError is true
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.667Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.667Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.667Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step
[ErrorRecovery] Skipping failed step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle mixed success and failure results
[22m[39m[ErrorRecovery] Partial success for batch-step: 2/3 (67%)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle mixed success and failure results
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error2',
  stepName: 'batch-step_item_1',
  timestamp: '2025-08-31T07:19:57.668Z',
  retryCount: 0,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all successful results
[22m[39m[ErrorRecovery] Partial success for batch-step: 2/2 (100%)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all failed results
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error1',
  stepName: 'batch-step_item_0',
  timestamp: '2025-08-31T07:19:57.670Z',
  retryCount: 0,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error2',
  stepName: 'batch-step_item_1',
  timestamp: '2025-08-31T07:19:57.671Z',
  retryCount: 0,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all failed results
[22m[39m[ErrorRecovery] Partial success for batch-step: 0/2 (0%)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mgetErrorSummary[2m > [22m[2mshould generate error summary
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout1',
  stepName: 'step1',
  timestamp: '2025-08-31T07:19:57.672Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'step2',
  timestamp: '2025-08-31T07:19:57.672Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout2',
  stepName: 'step1',
  timestamp: '2025-08-31T07:19:57.672Z',
  retryCount: 2,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mclearErrors[2m > [22m[2mshould clear all recorded errors
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T07:19:57.673Z',
  retryCount: 1,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mupdateStrategy[2m > [22m[2mshould update recovery strategy
[22m[39m[ErrorRecovery] Strategy updated: {
  maxRetries: 5,
  retryDelayMs: 2000,
  fallbackEnabled: true,
  skipOnError: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mupdateStrategy[2m > [22m[2mshould partially update strategy
[22m[39m[ErrorRecovery] Strategy updated: {
  maxRetries: 5,
  retryDelayMs: 1000,
  fallbackEnabled: true,
  skipOnError: false
}

 [32m✓[39m tests/unit/workflows/error-recovery.test.ts [2m([22m[2m31 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/workflows.batch-embeddings.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 18[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/bulk-sync.test.ts[2m > [22m[2mBulk Sync Notion Pages Route[2m > [22m[2mPOST /notion/pages/bulk-sync[2m > [22m[2mshould handle NotionManager errors
[22m[39mBulk sync error: Error: NotionManager connection failed
    at /C:/node/vector-db/tests/unit/routes/notion/bulk-sync.test.ts:244:63
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/bulk-sync.test.ts[2m > [22m[2mBulk Sync Notion Pages Route[2m > [22m[2mPOST /notion/pages/bulk-sync[2m > [22m[2mshould handle non-Error exceptions
[22m[39mBulk sync error: String error

 [32m✓[39m tests/unit/routes/notion/bulk-sync.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/logging.test.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mresetStatistics[2m > [22m[2mshould reset statistics
[22m[39m{"timestamp":"2025-08-31T07:19:57.905Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"Statistics reset"}}

[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mclearHistory[2m > [22m[2mshould clear search history
[22m[39m{"timestamp":"2025-08-31T07:19:57.906Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"Search history cleared"}}

[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mstate management[2m > [22m[2mshould restore state correctly
[22m[39m{"timestamp":"2025-08-31T07:19:57.907Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"State restored","historySize":1,"recentVectorsCount":1}}

 [32m✓[39m tests/unit/durable-objects/vector-statistics.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/vector-operations.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 16[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/retrieve-blocks.test.ts[2m > [22m[2mRetrieve Notion Blocks Route[2m > [22m[2mGET /notion/pages/{pageId}/blocks[2m > [22m[2mshould handle errors from NotionService
[22m[39mRetrieve blocks error: Error: Database connection error
    at /C:/node/vector-db/tests/unit/routes/notion/retrieve-blocks.test.ts:228:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/retrieve-blocks.test.ts[2m > [22m[2mRetrieve Notion Blocks Route[2m > [22m[2mGET /notion/pages/{pageId}/blocks[2m > [22m[2mshould handle non-Error exceptions
[22m[39mRetrieve blocks error: String error

 [32m✓[39m tests/unit/routes/notion/retrieve-blocks.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32m✓[39m tests/unit/base/job-manager.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[2m16:19:58[22m [33m[1m[vite][22m[39m [33mwarning: [33mDuplicate member "testGetMultiple" in class body[33m
40 |    }
41 |  
42 |    async testGetMultiple(keys: string[]) {
   |          ^
43 |      return this.getMultipleFromStorage(keys)
44 |    }
[39m
  Plugin: [35mvite:esbuild[39m
  File: [36mC:/node/vector-db/tests/unit/base/durable-object.test.ts[39m
 [32m✓[39m tests/unit/base/durable-object.test.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 33[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/auth.test.ts [2m([22m[2m23 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/files/status.test.ts[2m > [22m[2mFile Status Route[2m > [22m[2mGET /files/status/{workflowId}[2m > [22m[2mshould handle other errors
[22m[39mFile status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/files/status.test.ts:183:74
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/files/status.test.ts[2m > [22m[2mFile Status Route[2m > [22m[2mGET /files/status/{workflowId}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mFile status error: String error

 [32m✓[39m tests/unit/routes/files/status.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould delete vectors successfully
[22m[39m[bulk-delete] Deleting 3 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 3 vectors

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle deletion errors
[22m[39m[bulk-delete] Deleting 150 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle deletion errors
[22m[39m[bulk-delete] Batch 1 failed: Error: Delete failed
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:74:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle non-Error deletion failures
[22m[39m[bulk-delete] Deleting 150 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle non-Error deletion failures
[22m[39m[bulk-delete] Batch 1 failed: String error

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle VectorManager update failure gracefully
[22m[39m[bulk-delete] Deleting 1 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 1 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle VectorManager update failure gracefully
[22m[39m[bulk-delete] Failed to update VectorManager state: Error: Update failed
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:113:74
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould process batches correctly
[22m[39m[bulk-delete] Deleting 250 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 100 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 100 vectors
[bulk-delete] Batch 3: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mHandler direct tests for edge cases[2m > [22m[2mshould handle general errors in the main try-catch
[22m[39mBulk delete vectors error: Error: Unexpected error
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:220:65
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mHandler direct tests for edge cases[2m > [22m[2mshould handle non-Error objects in the main catch
[22m[39mBulk delete vectors error: String error

 [32m✓[39m tests/unit/routes/vectors/bulk-delete.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/error.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/retrieve-page.test.ts[2m > [22m[2mRetrieve Notion Page Route[2m > [22m[2mGET /notion/pages/{pageId}[2m > [22m[2mshould handle errors from NotionOrchestrator
[22m[39mError: {
  timestamp: '2025-08-31T07:19:58.602Z',
  path: '/notion/pages/page-error',
  method: 'GET',
  query: {},
  error: {
    name: 'Error',
    message: 'Database connection error',
    stack: 'Error: Database connection error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/notion/retrieve-page.test.ts:124:37\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/notion/retrieve-page.test.ts[2m > [22m[2mRetrieve Notion Page Route[2m > [22m[2mGET /notion/pages/{pageId}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T07:19:58.604Z',
  path: '/notion/pages/page-error',
  method: 'GET',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/notion/retrieve-page.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould perform semantic search successfully
[22m[39m[2025-08-31T07:19:58.736Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test search query',
    topK: 5,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.737Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 2,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle search with namespace
[22m[39m[2025-08-31T07:19:58.739Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'namespace search',
    topK: 10,
    namespace: 'test-namespace'
  }
}
[2025-08-31T07:19:58.739Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 1,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould use default topK when not provided
[22m[39m[2025-08-31T07:19:58.741Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'minimal search',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.741Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle AI embedding generation failure
[22m[39m[2025-08-31T07:19:58.747Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.748Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search failed with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at semanticSearchHandler (/C:/node/vector-db/src/routes/api/search/semantic.ts:760:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:144:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle AI run without data property
[22m[39m[2025-08-31T07:19:58.749Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.749Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search failed with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at semanticSearchHandler (/C:/node/vector-db/src/routes/api/search/semantic.ts:760:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:161:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle vectorize query errors
[22m[39m[2025-08-31T07:19:58.751Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.751Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search failed with AppError',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at semanticSearchHandler (/C:/node/vector-db/src/routes/api/search/semantic.ts:760:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:175:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: undefined,
    statusCode: 500,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:19:58.752Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'non-error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.753Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search failed with AppError',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at semanticSearchHandler (/C:/node/vector-db/src/routes/api/search/semantic.ts:760:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:192:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: undefined,
    statusCode: 500,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle empty search results
[22m[39m[2025-08-31T07:19:58.758Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'no results',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.758Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle special characters in query
[22m[39m[2025-08-31T07:19:58.761Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'special&chars+test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.761Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 1,
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/semantic.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/routes/index.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 9[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould search vectors successfully
[22m[39m[2025-08-31T07:19:58.949Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test search query',
    topK: 5,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.949Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 2,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle search with namespace and filter
[22m[39m[2025-08-31T07:19:58.951Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'filtered search',
    topK: 10,
    namespace: 'test-namespace'
  }
}
[2025-08-31T07:19:58.951Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 1,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould use default topK when not provided
[22m[39m[2025-08-31T07:19:58.953Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'minimal search',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.953Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle AI embedding generation failure
[22m[39m[2025-08-31T07:19:58.957Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.958Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:161:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle AI run without data property
[22m[39m[2025-08-31T07:19:58.963Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.963Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:181:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle vectorize query errors
[22m[39m[2025-08-31T07:19:58.965Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.966Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:198:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:19:58.967Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'non-error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.968Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:218:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould include values when requested
[22m[39m[2025-08-31T07:19:58.969Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'include values test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T07:19:58.969Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 1,
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/vectors.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould find similar vectors successfully
[22m[39m[2025-08-31T07:19:59.066Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_123456',
    topK: 5,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.066Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_123456',
    resultCount: 2,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle namespace and excludeSelf parameters
[22m[39m[2025-08-31T07:19:59.068Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_test',
    topK: 10,
    namespace: 'test-namespace',
    excludeSelf: false
  }
}
[2025-08-31T07:19:59.069Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_test',
    resultCount: 1,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould use default values when optional parameters are not provided
[22m[39m[2025-08-31T07:19:59.070Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_minimal',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.070Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_minimal',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle vector not found error
[22m[39m[2025-08-31T07:19:59.077Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_nonexistent',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.078Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: 'Vector not found: vec_nonexistent',
      stack: 'AppError: Vector not found: vec_nonexistent\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1143:15)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:161:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle other errors
[22m[39m[2025-08-31T07:19:59.079Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_error',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.080Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: '類似検索中にエラーが発生しました',
      stack: 'AppError: 類似検索中にエラーが発生しました\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1148:13)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:177:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:19:59.081Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_unknown',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.081Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: '類似検索中にエラーが発生しました',
      stack: 'AppError: 類似検索中にエラーが発生しました\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1148:13)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:193:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle empty search results
[22m[39m[2025-08-31T07:19:59.083Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_no_similar',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.083Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_no_similar',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle special characters in vectorId
[22m[39m[2025-08-31T07:19:59.084Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_special-chars_123',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T07:19:59.084Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_special-chars_123',
    resultCount: 1,
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/similar.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/services.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-multiselect.test.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 9[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/delete.test.ts[2m > [22m[2mDelete Vector Route[2m > [22m[2mDELETE /vectors/{id}[2m > [22m[2mshould handle VectorManager errors
[22m[39mDelete vector error: Error: VectorManager error
    at /C:/node/vector-db/tests/unit/routes/vectors/delete.test.ts:59:9
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Error: {
  timestamp: '2025-08-31T07:19:59.281Z',
  path: '/vectors/test-id',
  method: 'DELETE',
  query: {},
  error: {
    name: 'Error',
    message: 'VectorManager error',
    stack: 'Error: VectorManager error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/vectors/delete.test.ts:59:9\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/vectors/delete.test.ts[2m > [22m[2mDelete Vector Route[2m > [22m[2mDELETE /vectors/{id}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mDelete vector error: String error
Error: {
  timestamp: '2025-08-31T07:19:59.283Z',
  path: '/vectors/test-id',
  method: 'DELETE',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/vectors/delete.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/delete-all.test.ts[2m > [22m[2mDelete All Vectors Route[2m > [22m[2mDELETE /vectors/all[2m > [22m[2mshould handle VectorManager errors
[22m[39mDelete all vectors error: Error: VectorManager error
    at /C:/node/vector-db/tests/unit/routes/vectors/delete-all.test.ts:91:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/delete-all.test.ts[2m > [22m[2mDelete All Vectors Route[2m > [22m[2mDELETE /vectors/all[2m > [22m[2mshould handle non-Error exceptions
[22m[39mDelete all vectors error: { code: 'UNKNOWN_ERROR' }

 [32m✓[39m tests/unit/routes/vectors/delete-all.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/batch-embeddings.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 25[2mms[22m[39m
 [32m✓[39m tests/unit/durable-objects/ai-embeddings.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 7[2mms[22m[39m
 [32m✓[39m tests/unit/utils/retry.test.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 16[2mms[22m[39m
[90mstderr[2m | tests/unit/services/notion-orchestrator.test.ts[2m > [22m[2mNotionOrchestrator[2m > [22m[2msyncAllPages[2m > [22m[2mshould handle sync errors gracefully
[22m[39mFailed to sync page page-2: Error: Sync failed
    at /C:/node/vector-db/tests/unit/services/notion-orchestrator.test.ts:106:93
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/services/notion-orchestrator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/list.test.ts[2m > [22m[2mList Vectors Route[2m > [22m[2mGET /vectors[2m > [22m[2mshould handle Durable Object errors
[22m[39mList vectors error: Error: List vectors failed
    at /C:/node/vector-db/tests/unit/routes/vectors/list.test.ts:171:55
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/list.test.ts[2m > [22m[2mList Vectors Route[2m > [22m[2mGET /vectors[2m > [22m[2mshould handle non-Error exceptions
[22m[39mList vectors error: String error

 [32m✓[39m tests/unit/routes/vectors/list.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs/{jobId}[2m > [22m[2mshould handle errors gracefully
[22m[39mGet job status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:57:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Get job status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:57:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs/{jobId}[2m > [22m[2mshould handle invalid job data gracefully
[22m[39mGet job status error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getJobStatus (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:973:91)
    at getJobStatusHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:648:45)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:77:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
Get job status error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getJobStatus (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:973:91)
    at getJobStatusHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:648:45)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:77:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle errors gracefully
[22m[39mGet all jobs error: Error: Database connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:143:68
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Get all jobs error: Error: Database connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:143:68
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle non-Error exceptions in getJobStatus
[22m[39mGet job status error: String error
Get job status error: String error

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle non-Error exceptions in getAllJobs
[22m[39mGet all jobs error: String error
Get all jobs error: String error

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle invalid jobs data gracefully
[22m[39mGet all jobs error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      0,
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      0,
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getAllJobs (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:994:124)
    at getAllJobsHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:740:35)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:190:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
Get all jobs error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      0,
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      0,
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getAllJobs (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:994:124)
    at getAllJobsHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:740:35)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:190:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/routes/vectors/status.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 7[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/embeddings.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould analyze PDF file successfully
[22m[39m[2025-08-31T07:20:00.087Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBwZGYgY29udGVudA==',
      namespace: 'test'
    },
    timestamp: '2025-08-31T07:20:00.087Z'
  }
}
[2025-08-31T07:20:00.087Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.088Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.088Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.088Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.088Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould analyze image file successfully
[22m[39m[2025-08-31T07:20:00.091Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.jpg',
      fileType: 'image/jpeg',
      fileSize: 2048,
      fileData: 'dGVzdCBpbWFnZSBjb250ZW50',
      metadata: [Object]
    },
    timestamp: '2025-08-31T07:20:00.091Z'
  }
}
[2025-08-31T07:20:00.091Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.jpg',
    fileType: 'image/jpeg',
    fileSize: 2048
  }
}
[2025-08-31T07:20:00.091Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.091Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'image'
  }
}
[2025-08-31T07:20:00.091Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.091Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'AI analyzed image: test.jpg',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould handle large files with simple analysis
[22m[39m[2025-08-31T07:20:00.094Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'large.pdf',
      fileType: 'application/pdf',
      fileSize: 3145728,
      fileData: 'bGFyZ2UgZmlsZSBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.094Z'
  }
}
[2025-08-31T07:20:00.094Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'large.pdf',
    fileType: 'application/pdf',
    fileSize: 3145728
  }
}
[2025-08-31T07:20:00.094Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.094Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'File too large for AI analysis',
    fileSize: 3145728,
    maxSize: 2097152
  }
}
[2025-08-31T07:20:00.095Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.095Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'Large pdf file: large.pdf',
      extractedText: 'large.pdf - pdf document (large file)',
      topics: 'pdf',
      keywords: 'large',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould reject unsupported file types
[22m[39m[2025-08-31T07:20:00.097Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.txt',
      fileType: 'text/plain',
      fileSize: 1024,
      fileData: 'dGV4dCBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.097Z'
  }
}
[2025-08-31T07:20:00.097Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.txt',
    fileType: 'text/plain',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.097Z] ERROR   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow failed',
    error: {
      name: 'AppError',
      message: 'Unsupported file type: text/plain',
      stack: 'AppError: Unsupported file type: text/plain\n' +
        '    at FileAnalyzer.execute (/C:/node/vector-db/src/workflows/file-analyzer.ts:1309:13)\n' +
        '    at FileAnalyzer.run (/C:/node/vector-db/src/base/workflow.ts:1618:60)\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/file-analyzer.test.ts:119:37\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)'
    },
    duration: 0,
    params: {
      fileName: 'test.txt',
      fileType: 'text/plain',
      fileSize: 1024,
      fileData: 'dGV4dCBjb250ZW50'
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould extract text from various AI response formats
[22m[39m[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.100Z'
  }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.100Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.100Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'Direct text response',
      topics: 'Direct text response',
      keywords: 'Direct text response',
      hasText: true,
      metadata: [Object]
    }
  }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.100Z'
  }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.100Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.100Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.101Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.101Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'OpenAI format response',
      topics: 'OpenAI format response',
      keywords: 'OpenAI format response',
      hasText: true,
      metadata: [Object]
    }
  }
}
[2025-08-31T07:20:00.101Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.101Z'
  }
}
[2025-08-31T07:20:00.101Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.101Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.101Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.117Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.118Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 17,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'Simple string response',
      topics: 'Simple string response',
      keywords: 'Simple string response',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould include metadata in analysis result
[22m[39m[2025-08-31T07:20:00.122Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'document.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50',
      namespace: 'docs',
      metadata: [Object]
    },
    timestamp: '2025-08-31T07:20:00.122Z'
  }
}
[2025-08-31T07:20:00.122Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'document.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.122Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.122Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.122Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.122Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'AI analyzed pdf: document.pdf',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould handle empty AI response
[22m[39m[2025-08-31T07:20:00.125Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T07:20:00.125Z'
  }
}
[2025-08-31T07:20:00.125Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T07:20:00.125Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T07:20:00.125Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T07:20:00.125Z] WARN   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'No text extracted from AI result'
  }
}
[2025-08-31T07:20:00.125Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T07:20:00.125Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'Large pdf file: test.pdf',
      extractedText: 'test.pdf - pdf document (large file)',
      topics: 'pdf',
      keywords: 'test',
      hasText: true,
      metadata: [Object]
    }
  }
}

 [32m✓[39m tests/unit/workflows/file-analyzer.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/generateEmbedding.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/cloudflare.schema.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould schedule batch embeddings successfully
[22m[39m[2025-08-31T07:20:00.341Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 5,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 2
  }
}
[2025-08-31T07:20:00.341Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-schedule-123',
    workflowCount: 5
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T07:20:00.343Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 1,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.344Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-minimal',
    workflowCount: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T07:20:00.349Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 2,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.349Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: {
      name: 'Error',
      message: 'Scheduling failed',
      stack: 'Error: Scheduling failed\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:147:66\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

[90mstderr[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle Durable Object errors
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.349Z',
  path: '/embeddings/schedule',
  method: 'POST',
  query: {},
  error: {
    name: 'AppError',
    message: 'Failed to generate batch embeddings: Scheduling failed',
    stack: 'AppError: Failed to generate batch embeddings: Scheduling failed\n' +
      '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
      '    at scheduleBatchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/schedule.ts:275:45)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
      '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
      '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:155:24\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)',
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    details: Error: Scheduling failed
        at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:147:66
        at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
        at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
        at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
        at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
        at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:20:00.351Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 1,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.351Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: { code: 'SCHEDULE_ERROR' }
  }
}

[90mstderr[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.351Z',
  path: '/embeddings/schedule',
  method: 'POST',
  query: {},
  error: {
    name: 'AppError',
    message: 'Failed to generate batch embeddings: Unknown error',
    stack: 'AppError: Failed to generate batch embeddings: Unknown error\n' +
      '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
      '    at scheduleBatchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/schedule.ts:275:45)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
      '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
      '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:171:24\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)',
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    details: { code: 'SCHEDULE_ERROR' }
  }
}

 [32m✓[39m tests/unit/routes/embeddings/schedule.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-extract.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/get.test.ts[2m > [22m[2mGet Vector Route[2m > [22m[2mGET /vectors/{id}[2m > [22m[2mshould handle VectorizeService errors
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.496Z',
  path: '/vectors/test-id',
  method: 'GET',
  query: {},
  error: {
    name: 'Error',
    message: 'Vectorize service error',
    stack: 'Error: Vectorize service error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/vectors/get.test.ts:75:38\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/vectors/get.test.ts[2m > [22m[2mGet Vector Route[2m > [22m[2mGET /vectors/{id}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.498Z',
  path: '/vectors/test-id',
  method: 'GET',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/vectors/get.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/file-upload.schema.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/services/notion-data-manager.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/sync-page.test.ts[2m > [22m[2mSync Notion Page Route[2m > [22m[2mPOST /notion/pages/{pageId}/sync[2m > [22m[2mshould handle sync errors
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.688Z',
  path: '/notion/pages/page-error/sync',
  method: 'POST',
  query: {},
  error: {
    name: 'Error',
    message: 'Sync failed',
    stack: 'Error: Sync failed\n' +
      '    at /C:/node/vector-db/tests/unit/routes/notion/sync-page.test.ts:135:38\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/notion/sync-page.test.ts[2m > [22m[2mSync Notion Page Route[2m > [22m[2mPOST /notion/pages/{pageId}/sync[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T07:20:00.690Z',
  path: '/notion/pages/page-error/sync',
  method: 'POST',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/notion/sync-page.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-schemas.test.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/search-validator.test.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould generate batch embeddings successfully
[22m[39m[2025-08-31T07:20:00.870Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 3,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10,
    saveToVectorize: true
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould generate batch embeddings successfully
[22m[39m[2025-08-31T07:20:00.875Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 3,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.876Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-123',
    workflowCount: 3
  }
}
[2025-08-31T07:20:00.876Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-123',
    workflowCount: 3,
    processingTime: 6
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T07:20:00.879Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 2,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T07:20:00.880Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 2,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.880Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-minimal',
    workflowCount: 2
  }
}
[2025-08-31T07:20:00.880Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-minimal',
    workflowCount: 2,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T07:20:00.889Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 2,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T07:20:00.890Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 2,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.890Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: {
      name: 'Error',
      message: 'Batch processing error',
      stack: 'Error: Batch processing error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:117:66\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}
[2025-08-31T07:20:00.891Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation failed with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to generate batch embeddings: Batch processing error',
      stack: 'AppError: Failed to generate batch embeddings: Batch processing error\n' +
        '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
        '    at batchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/batch.ts:745:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:124:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:20:00.893Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 1,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:20:00.894Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 1,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T07:20:00.894Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: 'String error'
  }
}
[2025-08-31T07:20:00.894Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation failed with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to generate batch embeddings: Unknown error',
      stack: 'AppError: Failed to generate batch embeddings: Unknown error\n' +
        '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
        '    at batchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/batch.ts:745:47)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:139:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    processingTime: 1
  }
}

 [32m✓[39m tests/unit/routes/embeddings/batch.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32m✓[39m tests/unit/routes/notion/page-formatter.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/job-service.test.ts[2m > [22m[2mVectorJobService[2m > [22m[2mgetJobStatus[2m > [22m[2mshould throw error on exception
[22m[39mGet job status error: Error: Connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/job-service.test.ts:52:56
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/routes/vectors/job-service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/search-service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould list available models successfully
[22m[39m[2025-08-31T07:20:01.111Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T07:20:01.112Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Successfully fetched models',
    modelsCount: 3,
    defaultModel: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle empty models list
[22m[39m[2025-08-31T07:20:01.114Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T07:20:01.114Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Successfully fetched models',
    modelsCount: 0,
    defaultModel: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T07:20:01.116Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T07:20:01.116Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to get available models',
    error: {
      name: 'Error',
      message: 'Failed to fetch models',
      stack: 'Error: Failed to fetch models\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:105:61\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}
[2025-08-31T07:20:01.116Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Failed to get models with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to get available models: Failed to fetch models',
      stack: 'AppError: Failed to get available models: Failed to fetch models\n' +
        '    at EmbeddingService.getAvailableModels (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1860:13)\n' +
        '    at Array.getAvailableModelsHandler (/C:/node/vector-db/src/routes/api/embeddings/models.ts:953:49)\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:109:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    code: 'INTERNAL_ERROR',
    statusCode: 500
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T07:20:01.122Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T07:20:01.122Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to get available models',
    error: 'Unknown error'
  }
}
[2025-08-31T07:20:01.122Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Failed to get models with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to get available models: Unknown error',
      stack: 'AppError: Failed to get available models: Unknown error\n' +
        '    at EmbeddingService.getAvailableModels (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1860:13)\n' +
        '    at Array.getAvailableModelsHandler (/C:/node/vector-db/src/routes/api/embeddings/models.ts:953:49)\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:121:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    code: 'INTERNAL_ERROR',
    statusCode: 500
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle network timeouts
[22m[39m[2025-08-31T07:20:01.124Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T07:20:01.125Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to get available models',
    error: {
      name: 'Error',
      message: 'Request timeout',
      stack: 'Error: Request timeout\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:129:61\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}
[2025-08-31T07:20:01.125Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Failed to get models with AppError',
    error: {
      name: 'AppError',
      message: 'Failed to get available models: Request timeout',
      stack: 'AppError: Failed to get available models: Request timeout\n' +
        '    at EmbeddingService.getAvailableModels (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1860:13)\n' +
        '    at Array.getAvailableModelsHandler (/C:/node/vector-db/src/routes/api/embeddings/models.ts:953:49)\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:133:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    code: 'INTERNAL_ERROR',
    statusCode: 500
  }
}

 [32m✓[39m tests/unit/routes/embeddings/models.test.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstderr[2m | tests/unit/services/notion-api-client.test.ts[2m > [22m[2mNotionAPIClient[2m > [22m[2mfetchPage[2m > [22m[2mshould throw error for other API errors
[22m[39mFailed to fetch page from Notion: Error: Notion API error: 500
    at NotionAPIClient.fetchPage (/C:/node/vector-db/src/services/notion-api-client.ts:1130:15)

 [32m✓[39m tests/unit/services/notion-api-client.test.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 8[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/create.test.ts[2m > [22m[2mCreate Vector Route[2m > [22m[2mPOST /vectors[2m > [22m[2mshould handle Durable Object errors
[22m[39mCreate vector error: Error: Vector creation failed
    at /C:/node/vector-db/tests/unit/routes/vectors/create.test.ts:110:61
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/create.test.ts[2m > [22m[2mCreate Vector Route[2m > [22m[2mPOST /vectors[2m > [22m[2mshould handle non-Error exceptions
[22m[39mCreate vector error: Unknown error

 [32m✓[39m tests/unit/routes/vectors/create.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/services/vector-search.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/routes/files/file-processor.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [2m[90m↓[39m[22m tests/unit/routes/embeddings.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m
 [32m✓[39m tests/unit/routes/files/file-validator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/embedding.schema.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/services/vector-operations.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32m✓[39m tests/unit/routes/vectors/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/db.test.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/routes/notion/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/routes/files/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-select-null.test.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/db.schema.test.ts
[22m[39mRunning DB Schema Tests

 [32m✓[39m tests/unit/db.schema.test.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 1[2mms[22m[39m
 [32m✓[39m tests/simple.test.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 1[2mms[22m[39m
vitest-pool-worker: Unable to remove temporary directory: Error: EBUSY: resource busy or locked, rmdir 'C:\Users\mtama\AppData\Local\Temp\miniflare-e8499b6dd2e102232eb2eda790932746\cache\miniflare-CacheObject'
vitest-pool-worker: Unable to remove temporary directory: Error: EBUSY: resource busy or locked, rmdir 'C:\Users\mtama\AppData\Local\Temp\miniflare-e8499b6dd2e102232eb2eda790932746\d1\miniflare-D1DatabaseObject'

[2m Test Files [22m [1m[32m79 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (80)[39m
[2m      Tests [22m [1m[32m1275 passed[39m[22m[2m | [22m[33m15 skipped[39m[90m (1290)[39m
[2m   Start at [22m 16:19:54
[2m   Duration [22m 7.51s[2m (transform 1.60s, setup 600ms, collect 3.80s, tests 832ms, environment 0ms, prepare 146ms)[22m

[34m % [39m[2mCoverage report from [22m[33mistanbul[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   84.63 |    77.73 |   84.67 |   84.56 |                   
 base              |   94.48 |    81.15 |   88.52 |   94.28 |                   
  ...ble-object.ts |      94 |    16.66 |   76.47 |      94 | 213,249-263       
  job-manager.ts   |   92.42 |    82.22 |   92.59 |      92 | ...02,250-255,414 
  workflow.ts      |   98.61 |      100 |   94.11 |   98.57 | 149               
 db                |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
 durable-objects   |    80.8 |    73.55 |   76.06 |   80.39 |                   
  ai-embeddings.ts |     100 |      100 |     100 |     100 |                   
  ...api-client.ts |       0 |        0 |       0 |       0 | 37-166            
  ...on-manager.ts |     100 |      100 |     100 |     100 |                   
  ...nc-manager.ts |       0 |        0 |       0 |       0 | 57-278            
  ...ob-manager.ts |   86.36 |    70.73 |   91.66 |    87.5 | ...55,175,231-235 
  ...or-manager.ts |     100 |      100 |     100 |     100 |                   
  ...statistics.ts |     100 |    76.66 |     100 |     100 | 63-83,118,282-284 
 ...bjects/schemas |     100 |      100 |     100 |     100 |                   
  ...ger.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ger.schema.ts |     100 |      100 |     100 |     100 |                   
 middleware        |   95.89 |    84.31 |     100 |   95.85 |                   
  auth.ts          |    98.5 |    86.56 |     100 |    98.5 | 222               
  error.ts         |     100 |      100 |     100 |     100 |                   
  logging.ts       |   95.31 |    83.78 |     100 |   95.23 | 143-156           
  validation.ts    |   93.15 |       80 |     100 |   93.05 | 68,111,121-124    
 ...api/embeddings |   81.25 |    72.72 |   77.77 |   81.64 |                   
  batch.ts         |   84.61 |    68.75 |     100 |      84 | 74,84,146-148     
  ...ng-service.ts |     100 |    93.47 |     100 |     100 | 192,236,294       
  generate.ts      |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  models.ts        |   36.58 |     6.25 |      20 |    37.5 | 99-101,169-266    
  schedule.ts      |     100 |       50 |     100 |     100 | 85                
 routes/api/files  |     100 |      100 |     100 |     100 |                   
  ...-processor.ts |     100 |      100 |     100 |     100 |                   
  ...-validator.ts |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  status.ts        |     100 |      100 |     100 |     100 |                   
  upload.ts        |     100 |      100 |     100 |     100 |                   
 routes/api/notion |     100 |    98.85 |     100 |     100 |                   
  bulk-sync.ts     |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  list-pages.ts    |     100 |      100 |     100 |     100 |                   
  ...-formatter.ts |     100 |    97.87 |     100 |     100 | 98                
  ...eve-blocks.ts |     100 |      100 |     100 |     100 |                   
  retrieve-page.ts |     100 |      100 |     100 |     100 |                   
  sync-page.ts     |     100 |      100 |     100 |     100 |                   
 routes/api/search |   84.42 |    80.95 |   94.11 |   84.42 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  ...ch-service.ts |   96.66 |    88.46 |     100 |   96.66 | 168               
  ...-validator.ts |     100 |      100 |     100 |     100 |                   
  semantic.ts      |      50 |       25 |      50 |      50 | 120-122,176-240   
  similar.ts       |     100 |      100 |     100 |     100 |                   
  vectors.ts       |     100 |      100 |     100 |     100 |                   
 ...es/api/vectors |   99.37 |    96.55 |     100 |   99.35 |                   
  bulk-delete.ts   |     100 |      100 |     100 |     100 |                   
  create.ts        |     100 |      100 |     100 |     100 |                   
  delete-all.ts    |     100 |      100 |     100 |     100 |                   
  delete.ts        |     100 |      100 |     100 |     100 |                   
  get.ts           |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  job-service.ts   |     100 |     90.9 |     100 |     100 | 86                
  list.ts          |     100 |      100 |     100 |     100 |                   
  status.ts        |   96.66 |     87.5 |     100 |   96.66 | 162               
 schemas           |     100 |      100 |     100 |     100 |                   
  ...are.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ult.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ing.schema.ts |     100 |      100 |     100 |     100 |                   
  error.schema.ts  |     100 |      100 |     100 |     100 |                   
  ...oad.schema.ts |     100 |      100 |     100 |     100 |                   
  notion.schema.ts |     100 |      100 |     100 |     100 |                   
  search.schema.ts |     100 |      100 |     100 |     100 |                   
  vector.schema.ts |     100 |      100 |     100 |     100 |                   
 services          |   90.62 |    79.92 |   95.23 |   91.17 |                   
  ...api-client.ts |   81.63 |    80.95 |     100 |   80.85 | ...87,129,144-145 
  ...ta-manager.ts |   72.97 |    46.34 |    82.6 |   75.36 | ...10,241,247-265 
  ...chestrator.ts |   97.36 |       85 |     100 |   97.36 | 90                
  ...on.service.ts |     100 |      100 |     100 |     100 |                   
  ...operations.ts |     100 |      100 |     100 |     100 |                   
  vector-search.ts |     100 |    88.88 |     100 |     100 | 21,32             
  ...ze.service.ts |     100 |      100 |     100 |     100 |                   
 utils             |   69.94 |    65.81 |   71.87 |   69.25 |                   
  error-handler.ts |     100 |    97.46 |     100 |     100 | 124,286           
  ...der-compat.ts |     100 |      100 |     100 |     100 |                   
  ...se-builder.ts |    4.87 |     6.25 |    7.69 |    4.87 | 89-321            
  retry.ts         |   84.04 |    57.57 |    90.9 |   83.33 | ...27-228,251,360 
  validation.ts    |   54.07 |    58.22 |    60.6 |   53.78 | ...65,494,522-523 
 workflows         |   77.31 |     74.8 |   81.29 |   77.19 |                   
  ...embeddings.ts |     100 |      100 |     100 |     100 |                   
  ...-processor.ts |       0 |        0 |       0 |       0 | 47-291            
  embeddings.ts    |     100 |      100 |     100 |     100 |                   
  ...r-recovery.ts |   98.86 |    89.47 |     100 |   98.78 | 196               
  file-analyzer.ts |      98 |       95 |     100 |   97.91 | 72                
  ...processing.ts |     100 |      100 |     100 |     100 |                   
  notion-sync.ts   |     100 |      100 |     100 |     100 |                   
  ...y-handlers.ts |   94.25 |    89.79 |     100 |   94.18 | ...01,219-220,259 
  ...te-machine.ts |   83.33 |    61.11 |   92.85 |   83.33 | 83-88,243-252     
  ...-generator.ts |       0 |        0 |       0 |       0 | 37-319            
  ...operations.ts |     100 |      100 |     100 |     100 |                   
 workflows/schemas |     100 |      100 |     100 |     100 |                   
  ...low.schema.ts |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------
[vpw:debug] Shutting down runtimes...
